{% load latex %}
{% autoescape off %}

\documentclass[a4paper,10pt]{scrartcl}
%\documentclass[a4paper,11pt]{scrartcl}

\usepackage[utf8x]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[ngerman]{babel}
\usepackage{longtable}
\usepackage{fancyhdr}
\usepackage{multirow}
\usepackage{pbox}
\usepackage{titlesec}
\usepackage{float}

\usepackage[top=1.5cm,bottom=1.5cm,left=2.0cm,right=1.5cm]{geometry}

\renewcommand*{\arraystretch}{1.5}

\pagestyle{fancy}
\renewcommand{\sectionmark}[1]{\markright{#1}}
\fancyhf{}
\rhead{\fancyplain{}{\tiny Ressort - \LARGE \thepage }}
\lhead{\fancyplain{}{\LARGE \rightmark }}
\cfoot{\fancyplain{}{\thepage}}

\newcommand{\fakesection}[1]{%
  \par\refstepcounter{section}% Increase section counter
  \sectionmark{#1}% Add section mark (header)
  % Add more content here, if needed.
  % but do not print stuff.
}

\titlespacing\subsubsection{0pt}{1.0ex plus -1ex minus -.2ex}{-2ex}

\begin{document}
{% for jobid, job in jobs.items %}
\fakesection{ {{ job.name |latex}} }
{% for date,day in job.day.items %}
\subsection { {{day.dow}} - {{date}} }
\noindent
\setlength\LTleft{0pt}
\setlength\LTright{0pt}
\begin{table}[H]
\begin{longtable}{|p{2.1cm}|p{5.5cm}|p{0.3cm}|p{0.3cm}|p{0.5cm}|p{6cm}|}
\hline
	Schicht & Name & B & E & P & Unterschrift \\{% for shift in day.shifts %}
\hline
\hline{% with shift_gifts|bykey:shift.id as gift %}
	\multirow{ {{shift.number}} }{*}{
  \pbox{2.1cm} { {{shift.time |latex}} {% if shift.name %}\\ \textbf{ {{shift.name |latex}} }{% endif %} } } {% for helper in shift.helpers.all|helpersort:"surname" %}
	& {{ helper.surname |latex}}, {{ helper.firstname |latex}}
	& {{ gift.beer|latex }}
	& {{ gift.food|latex }}
	& {% if shift.deposit %}P{% endif %} 
	& \\
	\cline{2-6}{% endfor %}{% for _ in shift.num_missing %}
	& %multirow
	& {{ gift.beer |latex}} 
	& {{ gift.food |latex}} 
	& {% if shift.deposit %}P{% endif %} 
	& \\
	\cline{2-6}{% endfor %} %missing in shift
	\hline {% endwith %} {% endfor %}
\end{longtable}
\end{table}{% endfor %} %days

\clearpage {% endfor %} %jobs

\end{document}
{% endautoescape %}
